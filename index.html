<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đánh bài cùng Bích Ngân ^_^</title>

<style>
  body {
    margin: 0;
    padding: 0;
    text-align: center;
  }

  #header {
    font-size: 10px;
    margin: 5px 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed; /* FIXED columns */
  }

  col.check { width: 8%; }
  col.player { width: 23%; }

  th, td {
    border: 1px solid black;
    padding: 5px;
    text-align: center;
    overflow: hidden;
  }

  /* ===== NAME ===== */
  th {
    white-space: nowrap;       /* NO WRAP */
    text-overflow: ellipsis;   /* ... if long */
  }

  input[type="text"] {
    width: 100%;
    box-sizing: border-box;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
    white-space: nowrap;
  }

  input[type="number"] {
    width: 100%;
    box-sizing: border-box;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
  }

  .score-positive { color: green; }
  .score-negative { color: red; }
  .score-neutral  { color: gray; }

  .total-score {
    font-size: 24px;
    font-weight: bold;
  }

  .check-positive { color: green; font-weight: bold; }
  .check-negative { color: red; font-weight: bold; }

  thead tr:first-child th {
    position: sticky;
    top: 0;
    background: white;
    z-index: 10;
  }

  thead tr:nth-child(2) td {
    position: sticky;
    top: 45px;
    background: white;
    z-index: 5;
  }

  button {
    margin: 5px;
    padding: 5px 10px;
  }
</style>
</head>

<body>

<div id="header">------ Nam Vo ------</div>

<table id="scoreTable">
  <colgroup>
    <col class="check">
    <col class="player">
    <col class="player">
    <col class="player">
    <col class="player">
  </colgroup>

  <thead>
    <tr>
      <th></th>
      <th><input id="name-0" value="Bích Ngân" onblur="setName(0)"></th>
      <th><input id="name-1" value="Phương Nam" onblur="setName(1)"></th>
      <th><input id="name-2" value="Cẩm Lệ" onblur="setName(2)"></th>
      <th><input id="name-3" value="Nhật Nam" onblur="setName(3)"></th>
    </tr>
    <tr>
      <td></td>
      <td><span id="total-score-0" class="total-score score-neutral">0</span></td>
      <td><span id="total-score-1" class="total-score score-neutral">0</span></td>
      <td><span id="total-score-2" class="total-score score-neutral">0</span></td>
      <td><span id="total-score-3" class="total-score score-neutral">0</span></td>
    </tr>
  </thead>

  <tbody></tbody>
</table>

<button onclick="enterPoints()">Enter Points</button>
<button onclick="completeScores()">Complete</button>
<button onclick="resetGame()">Reset</button>

<script>
const STORAGE_KEY = "score_table_v1";

function setName(i) {
  const input = document.getElementById("name-" + i);
  const th = input.parentElement;
  th.textContent = input.value.trim();
  saveState();
}

function enterPoints() {
  const tbody = document.querySelector("#scoreTable tbody");
  const row = tbody.insertRow();

  row.insertCell(0).innerHTML = "";

  for (let i = 0; i < 4; i++) {
    const cell = row.insertCell(i + 1);
    cell.innerHTML = `<input type="number" class="score-input-${i}">`;
    cell.firstChild.addEventListener("input", saveState);
  }
}

function completeScores(showAlert = true) {
  for (let i = 0; i < 4; i++) {
    let total = 0;
    document.querySelectorAll(".score-input-" + i)
      .forEach(inp => total += parseInt(inp.value) || 0);

    const el = document.getElementById("total-score-" + i);
    el.textContent = total;
    el.className =
      "total-score " +
      (total > 0 ? "score-positive" :
       total < 0 ? "score-negative" : "score-neutral");
  }

  let error = false;
  document.querySelectorAll("#scoreTable tbody tr").forEach(row => {
    let sum = 0;
    for (let i = 1; i <= 4; i++) {
      sum += parseInt(row.cells[i].firstChild.value) || 0;
    }
    row.cells[0].innerHTML =
      sum === 0
        ? '<span class="check-positive">O</span>'
        : '<span class="check-negative">X</span>';
    if (sum !== 0) error = true;
  });

  if (showAlert && error) {
    alert("Nhập sai rồi bạn êyyyy ^_^");
  }
  saveState();
}

function saveState() {
  const names = [];
  for (let i = 0; i < 4; i++) {
    const input = document.getElementById("name-" + i);
    if (input) names.push(input.value);
    else {
      const th = document.querySelectorAll("thead tr:first-child th")[i + 1];
      names.push(th.textContent);
    }
  }

  const rows = [];
  document.querySelectorAll("#scoreTable tbody tr").forEach(row => {
    const r = [];
    for (let i = 1; i <= 4; i++) r.push(row.cells[i].firstChild.value || "");
    rows.push(r);
  });

  localStorage.setItem(STORAGE_KEY, JSON.stringify({ names, rows }));
}

function loadState() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;
  const state = JSON.parse(raw);

  state.names.forEach((n, i) => {
    if (n) {
      const th = document.querySelectorAll("thead tr:first-child th")[i + 1];
      th.textContent = n;
    }
  });

  state.rows.forEach(r => {
    enterPoints();
    const last = document.querySelector("#scoreTable tbody tr:last-child");
    r.forEach((v, i) => last.cells[i + 1].firstChild.value = v);
  });

  completeScores(false);
}

function resetGame() {
  if (!confirm("Bắt đầu ván mới?")) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

window.addEventListener("DOMContentLoaded", loadState);
</script>

</body>
</html>

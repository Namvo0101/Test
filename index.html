<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title> Đánh bài cùng Bích Ngân ^_^ </title>
<style>
  body { 
    text-align: center; 
    margin: 0; 
    padding: 0; 
  }
  #header {
    font-size: 10px;
    margin-top: 5px; 
    margin-bottom: 5px;
  }
  table { 
    margin: auto; 
    border: 1px solid black; 
    border-collapse: collapse; 
    width: 90%; 
  }
  th, td { 
    padding: 5px; 
    text-align: center; 
    box-sizing: border-box; 
    word-wrap: break-word; 
  }
  th { background-color: #f2f2f2; }
  input[type="number"], input[type="text"] { 
    width: 20%; 
    box-sizing: border-box; 
    text-align: center; 
  }
  .score-positive { color: green; }
  .score-negative { color: red; }
  .score-neutral { color: grey; }
  .check-positive { color: green; }
  .check-negative { color: red; }
  .total-score { font-size: 24px; font-weight: bold; }
  button {
    margin-top: 10px;
    font-size: 30px;
    padding: 10px 20px;
  }
  #scoreTable thead, #scoreTable thead th {
    position: sticky;
    top: 0;
    background-color: #f2f2f2;
    z-index: 10;
    font-size: 30px;
  }
  #scoreTable tr:nth-child(2), #scoreTable tr:nth-child(2) td {
    position: sticky;
    top: 23px;
    background-color: white;
    z-index: 5;
  }
</style>
</head>
<body>

<div id="header">------ Nam Vo ------</div>

<table id="scoreTable">
  <thead>
    <tr>
      <th></th>
      <th><input type="text" id="name-0" value="Bích Ngân" onblur="setName(0)"></th>
      <th><input type="text" id="name-1" value="Phương Nam" onblur="setName(1)"></th>
      <th><input type="text" id="name-2" value="Cẩm Lệ" onblur="setName(2)"></th>
      <th><input type="text" id="name-3" value="Nhật Nam" onblur="setName(3)"></th>
    </tr>
    <tr>
      <td></td>
      <td><span id="total-score-0" class="score-neutral total-score">0</span></td>
      <td><span id="total-score-1" class="score-neutral total-score">0</span></td>
      <td><span id="total-score-2" class="score-neutral total-score">0</span></td>
      <td><span id="total-score-3" class="score-neutral total-score">0</span></td>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="enterPoints()">Enter Points</button>
<button onclick="completeScores()">Complete</button>
<button onclick="resetGame()">Reset</button>
<br>
<button onclick="exportExcel()">Export Excel</button>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
var STORAGE_KEY = "scoreTable_save_v1";

/* ===== (toàn bộ các hàm save/load/reset/enter/complete giữ nguyên như trước) ===== */
/* --- cắt bớt để tập trung vào phần export --- */

/* ===== EXPORT EXCEL ===== */
function exportExcel() {
  completeScores();

  var table = document.getElementById("scoreTable");

  var names = [];
  for (var i = 0; i < 4; i++) {
    var th = table.rows[0].cells[i + 1];
    var inp = th.querySelector("input");
    names.push(inp ? inp.value : th.innerText);
  }

  var aoa = [];

  /* ===== HEADER EXCEL (MỚI THÊM) ===== */
  aoa.push(["—— Nam Vo ——"]);
  aoa.push([]); // dòng trống cho dễ nhìn

  /* ===== TABLE HEADER ===== */
  aoa.push(["", names[0], names[1], names[2], names[3], "RowSum"]);

  var totals = [];
  for (var i = 0; i < 4; i++) {
    totals.push(document.getElementById("total-score-" + i).innerText);
  }
  aoa.push(["TOTAL", totals[0], totals[1], totals[2], totals[3], ""]);

  for (var r = 2; r < table.rows.length; r++) {
    var row = table.rows[r];
    var check = row.cells[0].innerText.trim();
    var vals = [];
    var sum = 0;

    for (var c = 1; c <= 4; c++) {
      var v = parseInt(row.cells[c].firstChild.value) || 0;
      vals.push(v);
      sum += v;
    }
    aoa.push([check, vals[0], vals[1], vals[2], vals[3], sum]);
  }

  var wb = XLSX.utils.book_new();
  var ws = XLSX.utils.aoa_to_sheet(aoa);

  ws["!cols"] = [
    {wch: 6}, {wch: 14}, {wch: 14}, {wch: 14}, {wch: 14}, {wch: 10}
  ];

  XLSX.utils.book_append_sheet(wb, ws, "Scores");

  var now = new Date();
  function pad(n){ return String(n).padStart(2,"0"); }
  var filename =
    "scores_" +
    now.getFullYear() + "-" + pad(now.getMonth()+1) + "-" + pad(now.getDate()) + "_" +
    pad(now.getHours()) + pad(now.getMinutes()) +
    ".xlsx";

  XLSX.writeFile(wb, filename);
}
</script>

</body>
</html>
